# NaviHive æœ¬åœ°è¿è¡ŒæŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•åœ¨æœ¬åœ°ç¯å¢ƒä¸­è¿è¡Œå’Œå¼€å‘ NaviHive é¡¹ç›®ã€‚

## å‰ç½®è¦æ±‚

åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨çš„ç³»ç»Ÿå·²å®‰è£…ä»¥ä¸‹è½¯ä»¶ï¼š

- **Node.js**: ç‰ˆæœ¬ 18 æˆ–æ›´é«˜ ([ä¸‹è½½åœ°å€](https://nodejs.org/))
- **pnpm**: åŒ…ç®¡ç†å™¨ ([å®‰è£…å‘½ä»¤](https://pnpm.io/installation))
- **Git**: ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ ([ä¸‹è½½åœ°å€](https://git-scm.com/))

### å®‰è£… pnpm

```bash
# ä½¿ç”¨ npm å®‰è£…
npm install -g pnpm

# æˆ–ä½¿ç”¨ Homebrew (macOS)
brew install pnpm

# éªŒè¯å®‰è£…
pnpm --version
```

## æ–¹å¼ä¸€ï¼šä»…å‰ç«¯å¼€å‘ï¼ˆä½¿ç”¨ Mock æ•°æ®ï¼‰

å¦‚æœæ‚¨åªéœ€è¦ä¿®æ”¹å‰ç«¯ç•Œé¢ï¼Œå¯ä»¥ä½¿ç”¨ Mock æ•°æ®æ¨¡å¼å¿«é€Ÿå¼€å‘ã€‚

### æ­¥éª¤ 1: å®‰è£…ä¾èµ–

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
pnpm install
```

### æ­¥éª¤ 2: å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
# å¯åŠ¨ Vite å¼€å‘æœåŠ¡å™¨
pnpm dev
```

### æ­¥éª¤ 3: è®¿é—®åº”ç”¨

æ‰“å¼€æµè§ˆå™¨è®¿é—®: [http://localhost:5173](http://localhost:5173)

### Mock æ•°æ®æ¨¡å¼ç‰¹ç‚¹

- âœ… æ— éœ€é…ç½® Cloudflare Workers
- âœ… æ— éœ€åˆ›å»º D1 æ•°æ®åº“
- âœ… å¿«é€Ÿå¯åŠ¨ï¼Œé€‚åˆå‰ç«¯å¼€å‘
- âŒ æ— æ³•æµ‹è¯•çœŸå® API è°ƒç”¨
- âŒ æ— æ³•æµ‹è¯•è®¤è¯åŠŸèƒ½
- âŒ æ•°æ®ä¸ä¼šæŒä¹…åŒ–

## æ–¹å¼äºŒï¼šå®Œæ•´æœ¬åœ°å¼€å‘ï¼ˆå‰ç«¯ + Workerï¼‰

è¿™æ˜¯æ¨èçš„å®Œæ•´å¼€å‘æ¨¡å¼ï¼Œå¯ä»¥æµ‹è¯•å‰åç«¯å®Œæ•´åŠŸèƒ½ã€‚

### æ­¥éª¤ 1: å®‰è£…ä¾èµ–

```bash
pnpm install
```

### æ­¥éª¤ 2: åˆ›å»ºæœ¬åœ° D1 æ•°æ®åº“

```bash
# åˆ›å»ºæœ¬åœ°æ•°æ®åº“
wrangler d1 create mynav-local
```

è®°å½•ä¸‹è¾“å‡ºçš„ `database_id`ï¼Œä¸‹ä¸€æ­¥éœ€è¦ä½¿ç”¨ã€‚

### æ­¥éª¤ 3: é…ç½® Wrangler

åˆ›å»ºæˆ–ä¿®æ”¹ `wrangler.local.jsonc` æ–‡ä»¶ï¼š

```jsonc
{
  "$schema": "node_modules/wrangler/config-schema.json",
  "name": "mynav-local",
  "main": "worker/index.ts",
  "compatibility_date": "2025-04-05",
  "compatibility_flags": ["nodejs_compat"],
  "assets": {
    "not_found_handling": "single-page-application"
  },
  "observability": {
    "enabled": true
  },
  "d1_databases": [
    {
      "binding": "DB",
      "database_name": "mynav-local",
      "database_id": "ä¸Šä¸€æ­¥è·å–çš„ database_id"
    }
  ],
  "vars": {
    "AUTH_ENABLED": "true",
    "AUTH_USERNAME": "admin",
    "AUTH_PASSWORD": "$2y$10$YourHashedPasswordHere",
    "AUTH_SECRET": "YourSecretKeyHere"
  }
}
```

### æ­¥éª¤ 4: ç”Ÿæˆå¯†ç å“ˆå¸Œ

```bash
# è¿è¡Œå¯†ç å“ˆå¸Œè„šæœ¬
pnpm hash-password
```

è¾“å…¥æ‚¨çš„å¯†ç ï¼Œè„šæœ¬ä¼šç”Ÿæˆ bcrypt å“ˆå¸Œå€¼ï¼Œå¤åˆ¶åˆ° `wrangler.local.jsonc` çš„ `AUTH_PASSWORD` å­—æ®µã€‚

**ç¤ºä¾‹**:
```bash
$ pnpm hash-password
? è¯·è¾“å…¥è¦å“ˆå¸Œçš„å¯†ç : mypassword
å¯†ç å“ˆå¸Œ: $2y$10$YourHashedPasswordHere
```

### æ­¥éª¤ 5: åˆå§‹åŒ–æ•°æ®åº“

```bash
# æ–¹æ³•1: ä½¿ç”¨ SQL æ–‡ä»¶åˆå§‹åŒ–
wrangler d1 execute mynav-local --local --file=./init_table.sql

# æ–¹æ³•2: ä½¿ç”¨ SQL å‘½ä»¤åˆå§‹åŒ–
wrangler d1 execute mynav-local --local --command="CREATE TABLE IF NOT EXISTS groups (id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT NOT NULL, order_num INTEGER NOT NULL, is_public INTEGER DEFAULT 1, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP);"
```

### æ­¥éª¤ 6: å¯åŠ¨ Worker å¼€å‘æœåŠ¡å™¨

```bash
# å¯åŠ¨æœ¬åœ° Worker æœåŠ¡å™¨
wrangler dev --config wrangler.local.jsonc
```

Worker å°†åœ¨ [http://localhost:8788](http://localhost:8788) å¯åŠ¨ã€‚

### æ­¥éª¤ 7: å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨

åœ¨æ–°çš„ç»ˆç«¯çª—å£ä¸­ï¼š

```bash
# è®¾ç½®ç¯å¢ƒå˜é‡ä»¥ä½¿ç”¨çœŸå® API
VITE_USE_REAL_API=true pnpm dev
```

å‰ç«¯å°†åœ¨ [http://localhost:5173](http://localhost:5173) å¯åŠ¨ï¼Œå¹¶è¿æ¥åˆ°æœ¬åœ° Worker APIã€‚

### æ­¥éª¤ 8: è®¿é—®åº”ç”¨

æ‰“å¼€æµè§ˆå™¨è®¿é—®: [http://localhost:5173](http://localhost:5173)

ç™»å½•å‡­æ®ï¼š
- ç”¨æˆ·å: `admin`
- å¯†ç : æ‚¨åœ¨æ­¥éª¤ 4 ä¸­è®¾ç½®çš„å¯†ç 

## æ–¹å¼ä¸‰ï¼šä¸€é”®å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰

åˆ›å»ºä¸€ä¸ªä¸€é”®å¯åŠ¨è„šæœ¬ï¼Œç®€åŒ–æœ¬åœ°å¼€å‘æµç¨‹ã€‚

### åˆ›å»ºå¯åŠ¨è„šæœ¬

åˆ›å»ºæ–‡ä»¶ `scripts/start-local.sh`:

```bash
#!/bin/bash

# NaviHive æœ¬åœ°å¼€å‘å¯åŠ¨è„šæœ¬

echo "ğŸš€ NaviHive æœ¬åœ°å¼€å‘ç¯å¢ƒå¯åŠ¨"
echo "================================"

# æ£€æŸ¥æ˜¯å¦å®‰è£…äº†ä¾èµ–
if [ ! -d "node_modules" ]; then
  echo "ğŸ“¦ å®‰è£…ä¾èµ–..."
  pnpm install
fi

# æ£€æŸ¥æ˜¯å¦å­˜åœ¨ wrangler.local.jsonc
if [ ! -f "wrangler.local.jsonc" ]; then
  echo "âš ï¸  è­¦å‘Š: wrangler.local.jsonc ä¸å­˜åœ¨"
  echo "è¯·å…ˆåˆ›å»ºå¹¶é…ç½® wrangler.local.jsonc"
  echo "å‚è€ƒ: æ–¹å¼äºŒçš„æ­¥éª¤ 2-4"
  exit 1
fi

# æ£€æŸ¥æ•°æ®åº“æ˜¯å¦å·²åˆå§‹åŒ–
echo "ğŸ” æ£€æŸ¥æ•°æ®åº“çŠ¶æ€..."
DB_CHECK=$(curl -s http://localhost:8788/api/configs 2>/dev/null || echo "not_running")

if [ "$DB_CHECK" = "not_running" ]; then
  echo "ğŸ“Š Worker æœªè¿è¡Œï¼Œå°†å¯åŠ¨ Worker"
  echo "æ•°æ®åº“éœ€è¦åœ¨ Worker å¯åŠ¨ååˆå§‹åŒ–"
fi

echo ""
echo "ğŸ¯ å¯åŠ¨å‘½ä»¤è¯´æ˜:"
echo "1. ç»ˆç«¯ 1: wrangler dev --config wrangler.local.jsonc"
echo "2. ç»ˆç«¯ 2: VITE_USE_REAL_API=true pnpm dev"
echo ""
echo "ğŸ“ è®¿é—®åœ°å€:"
echo "å‰ç«¯: http://localhost:5173"
echo "API:  http://localhost:8788"
echo ""
echo "ğŸ’¡ æç¤º: æŒ‰ Ctrl+C åœæ­¢æœåŠ¡å™¨"
```

### ä½¿ç”¨å¯åŠ¨è„šæœ¬

```bash
# èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x scripts/start-local.sh

# è¿è¡Œè„šæœ¬
./scripts/start-local.sh
```

## å¸¸ç”¨å¼€å‘å‘½ä»¤

### å‰ç«¯å¼€å‘

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
pnpm build

# é¢„è§ˆç”Ÿäº§ç‰ˆæœ¬
pnpm preview

# ä»£ç æ ¼å¼åŒ–
pnpm format

# ä»£ç æ£€æŸ¥
pnpm lint
```

### Worker å¼€å‘

```bash
# å¯åŠ¨ Worker å¼€å‘æœåŠ¡å™¨
wrangler dev

# ä½¿ç”¨æŒ‡å®šé…ç½®æ–‡ä»¶
wrangler dev --config wrangler.local.jsonc

# åœ¨æœ¬åœ°æ¨¡å¼ä¸‹è¿è¡Œ
wrangler dev --local

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
wrangler tail

# ç”Ÿæˆ Worker ç±»å‹å®šä¹‰
pnpm cf-typegen
```

### æ•°æ®åº“æ“ä½œ

```bash
# åˆ›å»ºæ•°æ®åº“
wrangler d1 create mynav

# åˆ—å‡ºæ‰€æœ‰æ•°æ®åº“
wrangler d1 list

# æ‰§è¡Œ SQL æ–‡ä»¶
wrangler d1 execute mynav --file=./init_table.sql

# æ‰§è¡Œ SQL å‘½ä»¤
wrangler d1 execute mynav --command="SELECT * FROM groups"

# æœ¬åœ°æ•°æ®åº“æ“ä½œï¼ˆæ·»åŠ  --local æ ‡å¿—ï¼‰
wrangler d1 execute mynav-local --local --command="SELECT * FROM groups"

# å¤‡ä»½æ•°æ®åº“
wrangler d1 export mynav --output=./backup.sql

# æ¢å¤æ•°æ®åº“
wrangler d1 execute mynav --file=./backup.sql
```

## å¼€å‘è°ƒè¯•

### æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°

1. æ‰“å¼€å¼€å‘è€…å·¥å…· (F12)
2. åˆ‡æ¢åˆ° Console æ ‡ç­¾é¡µ
3. æŸ¥çœ‹å‰ç«¯æ—¥å¿—å’Œé”™è¯¯

### æŸ¥çœ‹ Worker æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹ Worker æ—¥å¿—
wrangler tail

# æŒ‰è¯·æ±‚è¿‡æ»¤
wrangler tail --format=pretty

# ä»…æŸ¥çœ‹é”™è¯¯
wrangler tail --format=pretty | grep ERROR
```

### è°ƒè¯• API

ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„ Network æ ‡ç­¾é¡µï¼š

1. æ‰“å¼€ Network æ ‡ç­¾é¡µ
2. è§¦å‘ API è¯·æ±‚
3. æŸ¥çœ‹è¯·æ±‚å’Œå“åº”è¯¦æƒ…
4. æ£€æŸ¥è¯·æ±‚å¤´ã€å“åº”çŠ¶æ€ç ã€å“åº”ä½“

### ä¿®æ”¹é…ç½®åé‡å¯

ä¿®æ”¹ä»¥ä¸‹æ–‡ä»¶åéœ€è¦é‡å¯æœåŠ¡å™¨ï¼š

- `worker/index.ts`: é‡å¯ Worker
- `src/`: Vite è‡ªåŠ¨çƒ­é‡è½½
- `wrangler.jsonc`: é‡å¯ Worker
- `.env` æˆ–ç¯å¢ƒå˜é‡: é‡å¯æœåŠ¡å™¨

## æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: pnpm install å¤±è´¥

**é”™è¯¯ä¿¡æ¯**: `ENOENT: no such file or directory`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ¸…ç†ç¼“å­˜
rm -rf node_modules pnpm-lock.yaml

# é‡æ–°å®‰è£…
pnpm install
```

### é—®é¢˜ 2: Wrangler æœªæ‰¾åˆ°å‘½ä»¤

**é”™è¯¯ä¿¡æ¯**: `command not found: wrangler`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# å…¨å±€å®‰è£… wrangler
pnpm add -g wrangler

# æˆ–ä½¿ç”¨ npx
npx wrangler --version
```

### é—®é¢˜ 3: æ•°æ®åº“è¿æ¥å¤±è´¥

**é”™è¯¯ä¿¡æ¯**: `Error: D1 database not found`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥æ•°æ®åº“æ˜¯å¦å­˜åœ¨
wrangler d1 list

# æ£€æŸ¥é…ç½®æ–‡ä»¶ä¸­çš„ database_id æ˜¯å¦æ­£ç¡®
cat wrangler.local.jsonc | grep database_id
```

### é—®é¢˜ 4: CORS é”™è¯¯

**é”™è¯¯ä¿¡æ¯**: `Access to fetch at ... has been blocked by CORS policy`

**è§£å†³æ–¹æ¡ˆ**:
- ç¡®è®¤ Worker å’Œå‰ç«¯éƒ½åœ¨è¿è¡Œ
- æ£€æŸ¥ `worker/index.ts` ä¸­çš„ CORS é…ç½®
- ç¡®è®¤ä½¿ç”¨ `VITE_USE_REAL_API=true` ç¯å¢ƒå˜é‡

### é—®é¢˜ 5: ç«¯å£è¢«å ç”¨

**é”™è¯¯ä¿¡æ¯**: `Port 5173 is already in use`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i :5173  # macOS/Linux
netstat -ano | findstr :5173  # Windows

# æ€æ­»è¿›ç¨‹
kill -9 <PID>  # macOS/Linux
taskkill /PID <PID> /F  # Windows

# æˆ–ä½¿ç”¨å…¶ä»–ç«¯å£
pnpm dev --port 3000
```

### é—®é¢˜ 6: è®¤è¯å¤±è´¥

**é”™è¯¯ä¿¡æ¯**: `ç™»å½•å¤±è´¥: ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# é‡æ–°ç”Ÿæˆå¯†ç å“ˆå¸Œ
pnpm hash-password

# æ›´æ–° wrangler.local.jsonc ä¸­çš„ AUTH_PASSWORD
# é‡å¯ Worker
```

## æµ‹è¯•æ•°æ®å¯¼å…¥

### å¯¼å…¥ç¤ºä¾‹æ•°æ®

åˆ›å»º `test_data.sql`:

```sql
-- æ’å…¥æµ‹è¯•åˆ†ç»„
INSERT INTO groups (name, order_num, is_public) VALUES
  ('å¸¸ç”¨å·¥å…·', 0, 1),
  ('å¼€å‘èµ„æº', 1, 1),
  ('å­¦ä¹ ç¬”è®°', 2, 1);

-- æ’å…¥æµ‹è¯•ç«™ç‚¹
INSERT INTO sites (group_id, name, url, icon, description, order_num, is_public) VALUES
  (1, 'Google', 'https://google.com', 'https://google.com/favicon.ico', 'æœç´¢å¼•æ“', 0, 1),
  (1, 'GitHub', 'https://github.com', 'https://github.com/favicon.ico', 'ä»£ç æ‰˜ç®¡', 1, 1),
  (2, 'Cloudflare', 'https://cloudflare.com', 'https://cloudflare.com/favicon.ico', 'CDN æœåŠ¡', 0, 1),
  (2, 'Vite', 'https://vitejs.dev', 'https://vitejs.dev/logo.svg', 'å‰ç«¯æ„å»ºå·¥å…·', 1, 1),
  (3, 'React', 'https://react.dev', 'https://react.dev/favicon.ico', 'React å®˜æ–¹æ–‡æ¡£', 0, 1);
```

æ‰§è¡Œå¯¼å…¥:

```bash
wrangler d1 execute mynav-local --local --file=./test_data.sql
```

## éƒ¨ç½²åˆ° Cloudflare

### éƒ¨ç½²æ­¥éª¤

```bash
# 1. æ„å»º
pnpm build

# 2. éƒ¨ç½²
pnpm deploy

# 3. åˆå§‹åŒ–è¿œç¨‹æ•°æ®åº“ï¼ˆé¦–æ¬¡éƒ¨ç½²ï¼‰
curl https://your-worker.workers.dev/api/init
```

### ç¯å¢ƒå˜é‡é…ç½®

åœ¨ `wrangler.jsonc` ä¸­é…ç½®ç”Ÿäº§ç¯å¢ƒå˜é‡ï¼š

```jsonc
{
  "vars": {
    "AUTH_ENABLED": "true",
    "AUTH_USERNAME": "your_username",
    "AUTH_PASSWORD": "$2y$10$YourProductionHash",
    "AUTH_SECRET": "YourProductionSecret"
  }
}
```

### æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€

```bash
# åˆ—å‡ºæ‰€æœ‰ Workers
wrangler deployments list

# æŸ¥çœ‹ç‰¹å®šéƒ¨ç½²
wrangler deployments list --name mynav
```

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### æœ¬åœ°å¼€å‘ä¼˜åŒ–

1. **ä½¿ç”¨ Mock æ•°æ®è¿›è¡Œå‰ç«¯å¼€å‘**
   - å‡å°‘å¯åŠ¨æ—¶é—´
   - æ— éœ€ç­‰å¾… Worker

2. **å¯ç”¨ Vite HMR**
   - å·²é»˜è®¤å¯ç”¨
   - ä¿®æ”¹ä»£ç å³æ—¶ç”Ÿæ•ˆ

3. **ç¦ç”¨ Worker æ—¥å¿—**
   - åœ¨å¼€å‘ç¯å¢ƒå¯ä»¥å‡å°‘æ—¥å¿—è¾“å‡º
   - ç”Ÿäº§ç¯å¢ƒä¿ç•™å®Œæ•´æ—¥å¿—

### ç”Ÿäº§æ„å»ºä¼˜åŒ–

```bash
# åˆ†ææ„å»ºäº§ç‰©
pnpm build

# æŸ¥çœ‹ dist/ ç›®å½•å¤§å°
du -sh dist/
```

## å‚è€ƒèµ„æº

- [Vite æ–‡æ¡£](https://vitejs.dev/)
- [Cloudflare Workers æ–‡æ¡£](https://developers.cloudflare.com/workers/)
- [Cloudflare D1 æ–‡æ¡£](https://developers.cloudflare.com/d1/)
- [Wrangler CLI æ–‡æ¡£](https://developers.cloudflare.com/workers/wrangler/)
- [React æ–‡æ¡£](https://react.dev/)
- [Material UI æ–‡æ¡£](https://mui.com/)

## è·å–å¸®åŠ©

é‡åˆ°é—®é¢˜ï¼Ÿ

1. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„"æ•…éšœæ’æŸ¥"éƒ¨åˆ†
2. æŸ¥çœ‹é¡¹ç›® GitHub Issues
3. æŸ¥é˜…å®˜æ–¹æ–‡æ¡£
4. åœ¨ç¤¾åŒºæé—®

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0.0
**æœ€åæ›´æ–°**: 2025-01-03
